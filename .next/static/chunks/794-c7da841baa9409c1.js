"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[794],{40293:function(e,s,a){a.d(s,{default:function(){return K}});var r=a(57437),t=a(2265),n=a(99376),l=a(27648),i=a(3612),c=a(16023),o=a(62869),d=a(16831),h=a(35974),u=a(84190),m=a(14938),x=a(60044),f=a(46221),p=a(95805),j=a(48736),g=a(29525),N=a(95252),w=a(31047),b=a(82718),y=a(10407),v=a(92451),C=a(98728),Z=a(94766),z=a(47692);let E=[{title:"Dashboard",href:"/dashboard",icon:m.Z,roles:["admin","owner","agent","tenant"]},{title:"Properties",href:"/properties",icon:x.Z,roles:["admin","owner","agent"]},{title:"Units",href:"/units",icon:f.Z,roles:["admin","owner","agent"]},{title:"Tenants",href:"/tenants",icon:p.Z,roles:["admin","owner","agent"]},{title:"Leases",href:"/leases",icon:j.Z,roles:["admin","owner","agent"]},{title:"Maintenance",href:"/maintenance",icon:g.Z,roles:["admin","owner","agent","tenant"]},{title:"Financials",href:"/financials",icon:N.Z,roles:["admin","owner"]},{title:"Reports",href:"/reports",icon:f.Z,roles:["admin","owner"]},{title:"Schedule",href:"/schedule",icon:w.Z,roles:["admin","agent"]},{title:"Messages",href:"/messages",icon:b.Z,roles:["admin","owner","agent","tenant"]}];function A(e){let{collapsed:s,onToggle:a}=e,{user:t}=(0,i.aC)(),m=(0,n.usePathname)(),f=async()=>{try{await (0,c.kS)(),window.location.href="/login"}catch(e){console.error("Error logging out:",e)}},p=E.filter(e=>e.roles.includes((null==t?void 0:t.role)||""));return t?(0,r.jsxs)("div",{className:"bg-white border-r border-gray-200 flex flex-col transition-all duration-300 ".concat(s?"w-16":"w-64"),children:[(0,r.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[!s&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:(0,r.jsx)(x.Z,{className:"w-5 h-5 text-white"})}),(0,r.jsx)("span",{className:"font-bold text-lg",children:"MMG"})]}),(0,r.jsx)(o.z,{variant:"ghost",size:"sm",onClick:a,className:"p-1 h-8 w-8",children:s?(0,r.jsx)(y.Z,{className:"h-4 w-4"}):(0,r.jsx)(v.Z,{className:"h-4 w-4"})})]})}),(0,r.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,r.jsxs)(u.h_,{children:[(0,r.jsx)(u.$F,{asChild:!0,children:(0,r.jsx)(o.z,{variant:"ghost",className:"w-full justify-start p-2 h-auto",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)(d.qE,{className:"h-8 w-8",children:[(0,r.jsx)(d.F$,{src:t.profile.avatar}),(0,r.jsxs)(d.Q5,{children:[t.profile.firstName.charAt(0),t.profile.lastName.charAt(0)]})]}),!s&&(0,r.jsxs)("div",{className:"flex-1 text-left",children:[(0,r.jsxs)("p",{className:"text-sm font-medium",children:[t.profile.firstName," ",t.profile.lastName]}),(0,r.jsx)(h.C,{variant:"secondary",className:"text-xs ".concat((e=>{switch(e){case"admin":return"bg-red-100 text-red-800";case"owner":return"bg-blue-100 text-blue-800";case"agent":return"bg-green-100 text-green-800";case"tenant":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}})(t.role)),children:(e=>{switch(e){case"admin":return"Administrator";case"owner":return"Property Owner";case"agent":return"Agent";case"tenant":return"Tenant";default:return e}})(t.role)})]})]})})}),(0,r.jsxs)(u.AW,{className:"w-56",align:"end",children:[(0,r.jsx)(u.Ju,{children:"My Account"}),(0,r.jsx)(u.VD,{}),(0,r.jsx)(u.Xi,{asChild:!0,children:(0,r.jsxs)(l.default,{href:"/profile",children:[(0,r.jsx)(C.Z,{className:"mr-2 h-4 w-4"}),"Profile Settings"]})}),(0,r.jsx)(u.Xi,{asChild:!0,children:(0,r.jsxs)(l.default,{href:"/notifications",children:[(0,r.jsx)(Z.Z,{className:"mr-2 h-4 w-4"}),"Notifications"]})}),(0,r.jsx)(u.VD,{}),(0,r.jsxs)(u.Xi,{onClick:f,className:"text-red-600",children:[(0,r.jsx)(z.Z,{className:"mr-2 h-4 w-4"}),"Log out"]})]})]})}),(0,r.jsx)("nav",{className:"flex-1 p-2 space-y-1",children:p.map(e=>{let a=m===e.href||m.startsWith(e.href+"/"),t=e.icon;return(0,r.jsx)(l.default,{href:e.href,children:(0,r.jsxs)(o.z,{variant:a?"secondary":"ghost",className:"w-full justify-start ".concat(s?"px-2":"px-3"," ").concat(a?"bg-blue-50 text-blue-700":""),children:[(0,r.jsx)(t,{className:"h-4 w-4"}),!s&&(0,r.jsx)("span",{className:"ml-3",children:e.title})]})},e.href)})}),!s&&(0,r.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,r.jsx)("div",{className:"text-xs text-gray-500 text-center",children:"\xa9 2024 MMG Property Consultancy"})})]}):null}var D=a(95186),k=a(73247),S=a(99397),O=a(92369),I=a(27312),_=a(94508);let M=I.fC,R=I.xz,P=t.forwardRef((e,s)=>{let{className:a,align:t="center",sideOffset:n=4,...l}=e;return(0,r.jsx)(I.h_,{children:(0,r.jsx)(I.VY,{ref:s,align:t,sideOffset:n,className:(0,_.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});P.displayName=I.VY.displayName;var q=a(43643);let X=t.forwardRef((e,s)=>{let{className:a,children:t,...n}=e;return(0,r.jsxs)(q.fC,{ref:s,className:(0,_.cn)("relative overflow-hidden",a),...n,children:[(0,r.jsx)(q.l_,{className:"h-full w-full rounded-[inherit]",children:t}),(0,r.jsx)(F,{}),(0,r.jsx)(q.Ns,{})]})});X.displayName=q.fC.displayName;let F=t.forwardRef((e,s)=>{let{className:a,orientation:t="vertical",...n}=e;return(0,r.jsx)(q.gb,{ref:s,orientation:t,className:(0,_.cn)("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...n,children:(0,r.jsx)(q.q4,{className:"relative flex-1 rounded-full bg-border"})})});F.displayName=q.gb.displayName;var J=a(6512),V=a(52093),L=a(5978),T=a(17293);a(63921);let Y=(0,L.hJ)(T.db,"notifications"),$=async e=>{try{let s=(0,L.IO)(Y,(0,L.ar)("recipients","array-contains",e),(0,L.Xo)("createdAt","desc")),a=await (0,L.PL)(s),r=[];return a.forEach(e=>{r.push({id:e.id,...e.data()})}),r}catch(e){throw console.error("Error getting user notifications:",e),e}},Q=async e=>{try{let s=(0,L.JU)(T.db,"notifications",e);await (0,L.r7)(s,{read:!0})}catch(e){throw console.error("Error marking notification as read:",e),e}};function U(){let{user:e}=(0,i.aC)(),[s,a]=(0,t.useState)([]),[n,l]=(0,t.useState)(!1),[c,d]=(0,t.useState)(!1);(0,t.useEffect)(()=>{e&&c&&u()},[e,c]);let u=async()=>{if(e){l(!0);try{let s=await $(e.id);a(s)}catch(e){console.error("Error loading notifications:",e)}finally{l(!1)}}},m=async e=>{if(!e.read)try{await Q(e.id),a(s=>s.map(s=>s.id===e.id?{...s,read:!0}:s))}catch(e){console.error("Error marking notification as read:",e)}},x=s.filter(e=>!e.read).length,f=e=>{switch(e){case"high":return"text-red-600";case"medium":return"text-yellow-600";default:return"text-blue-600"}},p=e=>{switch(e){case"lease_expiring":case"lease_expired":return"\uD83D\uDCCB";case"payment_due":return"\uD83D\uDCB0";case"maintenance_request":return"\uD83D\uDD27";default:return"\uD83D\uDCE2"}};return(0,r.jsxs)(M,{open:c,onOpenChange:d,children:[(0,r.jsx)(R,{asChild:!0,children:(0,r.jsxs)(o.z,{variant:"ghost",size:"sm",className:"relative",children:[(0,r.jsx)(Z.Z,{className:"h-4 w-4"}),x>0&&(0,r.jsx)(h.C,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center text-xs p-0",children:x>99?"99+":x})]})}),(0,r.jsx)(P,{className:"w-80",align:"end",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h4",{className:"font-semibold",children:"Notifications"}),x>0&&(0,r.jsxs)(h.C,{variant:"secondary",children:[x," unread"]})]}),(0,r.jsx)(J.Z,{}),(0,r.jsx)(X,{className:"h-[300px]",children:n?(0,r.jsx)("div",{className:"flex items-center justify-center py-6",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):0===s.length?(0,r.jsx)("div",{className:"text-center py-6 text-sm text-muted-foreground",children:"No notifications yet"}):(0,r.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,r.jsx)("div",{className:"p-3 rounded-lg border cursor-pointer transition-colors ".concat(e.read?"bg-gray-50 border-gray-200":"bg-blue-50 border-blue-200 hover:bg-blue-100"),onClick:()=>m(e),children:(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)("span",{className:"text-lg",children:p(e.type)}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h5",{className:"text-sm font-medium ".concat(f(e.priority)),children:e.title}),!e.read&&(0,r.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full"})]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:e.message}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:(0,V.WU)(e.createdAt.toDate(),"MMM dd, HH:mm")})]})]})},e.id))})}),s.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(J.Z,{}),(0,r.jsx)(o.z,{variant:"ghost",size:"sm",className:"w-full",children:"View all notifications"})]})]})})]})}function W(e){let{title:s,actions:a}=e,{user:n}=(0,i.aC)(),[h,m]=(0,t.useState)(""),f=async()=>{try{await (0,c.kS)(),window.location.href="/login"}catch(e){console.error("Error logging out:",e)}},j=(()=>{if(!n)return[];let e=[];switch(n.role){case"admin":case"owner":e.push({label:"Add Property",href:"/properties/new",icon:x.Z},{label:"Add Tenant",href:"/tenants/new",icon:p.Z},{label:"New Maintenance",href:"/maintenance/new",icon:g.Z});break;case"agent":e.push({label:"Add Tenant",href:"/tenants/new",icon:p.Z},{label:"New Maintenance",href:"/maintenance/new",icon:g.Z});break;case"tenant":e.push({label:"Request Maintenance",href:"/maintenance/new",icon:g.Z})}return e})();return n?(0,r.jsx)("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4 flex-1",children:[s&&(0,r.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:s}),(0,r.jsx)("div",{className:"max-w-md w-full",children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),console.log("Searching for:",h)},className:"relative",children:[(0,r.jsx)(k.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)(D.I,{type:"text",placeholder:"Search properties, tenants, requests...",value:h,onChange:e=>m(e.target.value),className:"pl-10 pr-4"})]})})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[a&&(0,r.jsx)("div",{className:"flex items-center space-x-2",children:a}),j.length>0&&(0,r.jsxs)(u.h_,{children:[(0,r.jsx)(u.$F,{asChild:!0,children:(0,r.jsxs)(o.z,{size:"sm",className:"h-9",children:[(0,r.jsx)(S.Z,{className:"h-4 w-4 mr-2"}),"New"]})}),(0,r.jsxs)(u.AW,{className:"w-48",align:"end",children:[(0,r.jsx)(u.Ju,{children:"Quick Actions"}),(0,r.jsx)(u.VD,{}),j.map(e=>(0,r.jsx)(u.Xi,{asChild:!0,children:(0,r.jsxs)(l.default,{href:e.href,children:[(0,r.jsx)(e.icon,{className:"mr-2 h-4 w-4"}),e.label]})},e.href))]})]}),(0,r.jsx)(U,{}),(0,r.jsx)(o.z,{variant:"ghost",size:"sm",className:"h-9 w-9 p-0",asChild:!0,children:(0,r.jsx)(l.default,{href:"/messages",children:(0,r.jsx)(b.Z,{className:"h-4 w-4"})})}),(0,r.jsxs)(u.h_,{children:[(0,r.jsx)(u.$F,{asChild:!0,children:(0,r.jsxs)(o.z,{variant:"ghost",className:"h-9 px-2",children:[(0,r.jsxs)(d.qE,{className:"h-6 w-6 mr-2",children:[(0,r.jsx)(d.F$,{src:n.profile.avatar}),(0,r.jsxs)(d.Q5,{className:"text-xs",children:[n.profile.firstName.charAt(0),n.profile.lastName.charAt(0)]})]}),(0,r.jsx)("span",{className:"hidden md:inline text-sm",children:n.profile.firstName})]})}),(0,r.jsxs)(u.AW,{className:"w-56",align:"end",children:[(0,r.jsx)(u.Ju,{children:(0,r.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,r.jsxs)("div",{className:"font-medium",children:[n.profile.firstName," ",n.profile.lastName]}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:n.email})]})}),(0,r.jsx)(u.VD,{}),(0,r.jsx)(u.Xi,{asChild:!0,children:(0,r.jsxs)(l.default,{href:"/profile",children:[(0,r.jsx)(O.Z,{className:"mr-2 h-4 w-4"}),"Profile"]})}),(0,r.jsx)(u.Xi,{asChild:!0,children:(0,r.jsxs)(l.default,{href:"/settings",children:[(0,r.jsx)(C.Z,{className:"mr-2 h-4 w-4"}),"Settings"]})}),(0,r.jsx)(u.VD,{}),(0,r.jsxs)(u.Xi,{onClick:f,className:"text-red-600",children:[(0,r.jsx)(z.Z,{className:"mr-2 h-4 w-4"}),"Log out"]})]})]})]})]})}):null}var B=a(36910),G=a(93022);function H(e){let{children:s,allowedRoles:a,requiredPermissions:l,requireAllPermissions:c=!1,redirectTo:o="/login",fallbackComponent:d}=e,{user:h,firebaseUser:u,loading:m,error:x,mfaRequired:f,permissionsLoaded:p}=(0,i.aC)(),j=(0,n.useRouter)(),g=(0,n.usePathname)(),[N,w]=(0,t.useState)(!1),[b,y]=(0,t.useState)(!1);return((0,t.useEffect)(()=>{(async()=>{if(!m&&p){if(!u||!h){j.push(o);return}if(!h.isActive){j.push("/account-disabled");return}if((0,B.Y_)(g)&&f||h.mfaSetupRequired&&!h.mfaEnabled&&"/auth/mfa-setup"!==g){j.push("/auth/mfa-setup");return}if(a&&!a.includes(h.role)){j.push("/unauthorized");return}if(l&&l.length>0){if(c){if(!l.every(e=>h.permissions.includes(e))){j.push("/unauthorized");return}}else if(!l.some(e=>h.permissions.includes(e))){j.push("/unauthorized");return}}if(!await (0,B.mn)(g)){j.push("/unauthorized");return}y(!0),w(!0)}})()},[h,u,m,f,p,a,l,c,o,j,g]),!m&&p&&N)?x?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-red-600 mb-2",children:"Authentication Error"}),(0,r.jsxs)("p",{className:"text-gray-600 mb-4",children:["There was an error loading your account: ",x.message]}),(0,r.jsx)("button",{onClick:()=>j.push("/login"),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Return to Login"})]})}):!u||!h||!h.isActive||(0,B.Y_)(g)&&f?null:b?(0,r.jsx)(r.Fragment,{children:s}):d?(0,r.jsx)(d,{}):null:(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto space-y-4",children:[(0,r.jsx)(G.O,{className:"h-8 w-64"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsx)(G.O,{className:"h-32"}),(0,r.jsx)(G.O,{className:"h-32"}),(0,r.jsx)(G.O,{className:"h-32"})]}),(0,r.jsx)(G.O,{className:"h-64"})]})})}function K(e){let{children:s,title:a,headerActions:n,requiredRoles:l,requiredPermissions:i}=e,[c,o]=(0,t.useState)(!1);return(0,r.jsx)(H,{requiredRoles:l,requiredPermissions:i,children:(0,r.jsxs)("div",{className:"h-screen flex bg-gray-50",children:[(0,r.jsx)(A,{collapsed:c,onToggle:()=>o(!c)}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,r.jsx)(W,{title:a,actions:n}),(0,r.jsx)("main",{className:"flex-1 overflow-y-auto",children:s})]})]})})}},16831:function(e,s,a){a.d(s,{F$:function(){return c},Q5:function(){return o},qE:function(){return i}});var r=a(57437),t=a(2265),n=a(61146),l=a(94508);let i=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(n.fC,{ref:s,className:(0,l.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...t})});i.displayName=n.fC.displayName;let c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(n.Ee,{ref:s,className:(0,l.cn)("aspect-square h-full w-full",a),...t})});c.displayName=n.Ee.displayName;let o=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(n.NY,{ref:s,className:(0,l.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...t})});o.displayName=n.NY.displayName},6512:function(e,s,a){a.d(s,{Z:function(){return i}});var r=a(57437),t=a(2265),n=a(55156),l=a(94508);let i=t.forwardRef((e,s)=>{let{className:a,orientation:t="horizontal",decorative:i=!0,...c}=e;return(0,r.jsx)(n.f,{ref:s,decorative:i,orientation:t,className:(0,l.cn)("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",a),...c})});i.displayName=n.f.displayName},48984:function(e,s,a){a.d(s,{E2:function(){return l},lK:function(){return c},vw:function(){return i},zI:function(){return o}});var r=a(5978);a(60062);var t=a(17293);let n=(0,r.hJ)(t.db,"properties"),l=async e=>{try{let s=(0,r.JU)(t.db,"properties",e);await (0,r.oe)(s)}catch(e){throw console.error("Error deleting property:",e),e}},i=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let s=(0,r.IO)(n);e.ownerId&&(s=(0,r.IO)(s,(0,r.ar)("ownerId","==",e.ownerId))),e.assignedAgentId&&(s=(0,r.IO)(s,(0,r.ar)("assignedAgents","array-contains",e.assignedAgentId))),e.type&&(s=(0,r.IO)(s,(0,r.ar)("type","==",e.type))),e.status&&(s=(0,r.IO)(s,(0,r.ar)("status","==",e.status))),s=(0,r.IO)(s,(0,r.Xo)("createdAt","desc")),e.pageSize&&(s=(0,r.IO)(s,(0,r.b9)(e.pageSize))),e.lastDoc&&(s=(0,r.IO)(s,(0,r.TQ)(e.lastDoc)));let a=await (0,r.PL)(s),t=[];return a.forEach(e=>{t.push({id:e.id,...e.data()})}),{properties:t,lastDoc:a.docs[a.docs.length-1],hasMore:a.docs.length===(e.pageSize||0)}}catch(e){throw console.error("Error getting properties:",e),e}},c=async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{let a=(0,r.IO)(n,(0,r.ar)("name",">=",e),(0,r.ar)("name","<=",e+""),(0,r.Xo)("name"),s(s)),t=await (0,r.PL)(a),l=[];return t.forEach(e=>{l.push({id:e.id,...e.data()})}),l}catch(e){throw console.error("Error searching properties:",e),e}},o=async(e,s,a)=>{try{let n=(0,r.JU)(t.db,"properties",e);await (0,r.r7)(n,{totalUnits:s,occupiedUnits:a,updatedAt:(0,r.Bt)()})}catch(e){throw console.error("Error updating property occupancy:",e),e}}}}]);