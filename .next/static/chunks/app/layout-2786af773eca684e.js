(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{80434:function(e,r,t){Promise.resolve().then(t.bind(t,3612)),Promise.resolve().then(t.t.bind(t,56050,23))},3612:function(e,r,t){"use strict";t.d(r,{AuthProvider:function(){return c},aC:function(){return l}});var a=t(57437),n=t(2265),s=t(5978),i=t(16023),u=t(17293);let o=(0,n.createContext)(void 0);function c(e){let{children:r}=e,[t,c]=(0,n.useState)(null),[l,d]=(0,n.useState)(null),[w,f]=(0,n.useState)(!0),p=async()=>{if(l)try{let e=await (0,i.Ts)();c(e)}catch(e){console.error("Error fetching user data:",e)}},m=async()=>{try{await (0,i.Mx)(),c(null),d(null)}catch(e){throw console.error("Error signing out:",e),e}};return(0,n.useEffect)(()=>{if(!(0,u.Wn)()){f(!1);return}let e=(0,i.yv)(async e=>{if(d(e),e){let r=(0,s.JU)(u.db,"users",e.uid),t=(0,s.cf)(r,r=>{r.exists()?c({...r.data(),id:e.uid}):c(null),f(!1)},e=>{console.error("Error listening to user document:",e),c(null),f(!1)});return()=>t()}c(null),f(!1)});return()=>e()},[]),(0,a.jsx)(o.Provider,{value:{user:t,firebaseUser:l,loading:w,signOut:m,refreshUser:p},children:r})}function l(){let e=(0,n.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},16023:function(e,r,t){"use strict";t.d(r,{Ac:function(){return P},Fs:function(){return E},Mx:function(){return m},OA:function(){return w},Rg:function(){return I},Ry:function(){return o},Sv:function(){return U},Ts:function(){return b},Yb:function(){return c},bl:function(){return x},c0:function(){return p},jz:function(){return d},kS:function(){return k},qD:function(){return f},qj:function(){return l},wP:function(){return A},yv:function(){return h}});var a=t(43301),n=t(5978),s=t(17293);let i=e=>{switch(e.code){case"auth/user-not-found":return"No account found with this email address.";case"auth/wrong-password":return"Incorrect password. Please try again.";case"auth/email-already-in-use":return"An account with this email already exists.";case"auth/weak-password":return"Password should be at least 6 characters long.";case"auth/invalid-email":return"Please enter a valid email address.";case"auth/user-disabled":return"This account has been disabled.";case"auth/too-many-requests":return"Too many failed attempts. Please try again later.";case"auth/network-request-failed":return"Network error. Please check your connection.";default:return e.message||"An unexpected error occurred."}},u=()=>{if(!(0,s.Wn)())throw Error("Firebase is not properly configured. Please set up your Firebase project.")},o=async(e,r)=>{u();try{let t=await (0,a.e5)(s.I8,e,r);return await g(t.user.uid),t}catch(e){throw Error(i(e))}},c=async function(e,r,t){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"tenant";u();try{let i=await (0,a.Xb)(s.I8,e,r);return await (0,a.ck)(i.user,{displayName:t}),await y(i.user,n),i}catch(e){throw Error(i(e))}},l=async()=>{u();try{let e=new a.hJ;e.addScope("email"),e.addScope("profile");let r=await (0,a.rh)(s.I8,e);return(await (0,n.QT)((0,n.JU)(s.db,"users",r.user.uid))).exists()?await g(r.user.uid):await y(r.user,"tenant"),r}catch(e){throw Error(i(e))}},d=e=>(u(),new a.lI(s.I8,e,{size:"normal",callback:()=>{},"expired-callback":()=>{}})),w=async(e,r)=>{u();try{return await (0,a.$g)(s.I8,e,r)}catch(e){throw Error(i(e))}},f=async(e,r)=>{try{let t=await e.confirm(r);return(await (0,n.QT)((0,n.JU)(s.db,"users",t.user.uid))).exists()?await g(t.user.uid):await y(t.user,"tenant"),t}catch(e){throw Error("Invalid verification code. Please try again.")}},p=async e=>{u();try{await (0,a.LS)(s.I8,e)}catch(e){throw Error(i(e))}},m=async()=>{u();try{await (0,a.w7)(s.I8)}catch(e){throw Error("Failed to sign out. Please try again.")}},h=e=>(u(),(0,a.Aj)(s.I8,e)),y=async(e,r)=>{var t,a;let i={id:e.uid,email:e.email,role:r,profile:{firstName:(null===(t=e.displayName)||void 0===t?void 0:t.split(" ")[0])||"",lastName:(null===(a=e.displayName)||void 0===a?void 0:a.split(" ").slice(1).join(" "))||"",avatar:e.photoURL||void 0},phone:e.phoneNumber||void 0,permissions:v(r),isActive:!0,mfaEnabled:!1,mfaSetupRequired:!1,lastLogin:(0,n.Bt)(),createdAt:(0,n.Bt)()};await (0,n.pl)((0,n.JU)(s.db,"users",e.uid),i)},g=async e=>{await (0,n.r7)((0,n.JU)(s.db,"users",e),{lastLogin:(0,n.Bt)()})},v=e=>{switch(e){case"admin":return["users:read","users:write","users:delete","properties:read","properties:write","properties:delete","leases:read","leases:write","leases:delete","maintenance:read","maintenance:write","maintenance:delete","payments:read","payments:write","payments:delete","reports:read","reports:write","settings:read","settings:write"];case"owner":return["properties:read","properties:write","leases:read","leases:write","maintenance:read","maintenance:write","payments:read","reports:read"];case"agent":return["properties:read","leases:read","leases:write","maintenance:read","maintenance:write","payments:read"];case"tenant":return["properties:read","leases:read","maintenance:read","maintenance:write","payments:read"];default:return[]}},b=async()=>{u();let e=s.I8.currentUser;if(!e)return null;let r=await (0,n.QT)((0,n.JU)(s.db,"users",e.uid));return r.exists()?r.data():null},I=async e=>{u();let r=e?await b():s.I8.currentUser?await b():null;return(null==r?void 0:r.role)||null},E=async(e,r)=>{u();let t=await b();return!!t&&t.permissions.includes(e)},A=async(e,r)=>{u();let t=await b();return!!t&&e.every(e=>t.permissions.includes(e))},P=async(e,r)=>{u();let t=await b();return!!t&&e.includes(t.role)},k=m,U=async e=>{u();try{let e=s.I8.currentUser;if(!e)return!1;let r=await (0,n.QT)((0,n.JU)(s.db,"users",e.uid));if(!r.exists())return!1;let t=r.data();return!0===t.isActive}catch(e){return console.error("Session validation error:",e),!1}},x=async(e,r,t)=>{u();try{var a;let i=t||(null===(a=s.I8.currentUser)||void 0===a?void 0:a.uid);if(!i)return;await (0,n.pl)((0,n.JU)(s.db,"audit_logs","".concat(i,"_").concat(Date.now())),{userId:i,eventType:e,eventData:r,timestamp:(0,n.Bt)(),userAgent:window.navigator.userAgent,ipAddress:null})}catch(e){console.error("Audit logging error:",e)}}},17293:function(e,r,t){"use strict";t.d(r,{I8:function(){return l},Wn:function(){return w},db:function(){return c},tO:function(){return d}});var a=t(738),n=t(5978),s=t(43301),i=t(60062),u=t(85434);let o=(0,a.C6)().length?(0,a.Mq)():(0,a.ZF)({apiKey:"AIzaSyD-w4tP94wfkorfa0vgKFd4kVYU-qDqe48",authDomain:"mmg-platform.firebaseapp.com",databaseURL:"https://mmg-platform-default-rtdb.europe-west1.firebasedatabase.app",projectId:"mmg-platform",storageBucket:"mmg-platform.firebasestorage.app",messagingSenderId:"220106972775",appId:"1:220106972775:web:04a44cb649fb1c617afec2"}),c=(0,n.ad)(o),l=(0,s.v0)(o),d=(0,i.cF)(o);(0,u.$C)(o);let w=()=>!0;w()||console.warn("\uD83D\uDD25 Firebase is using demo configuration. Please set up your Firebase project and update environment variables.")},56050:function(){}},function(e){e.O(0,[4387,4358,139,92,2971,2117,1744],function(){return e(e.s=80434)}),_N_E=e.O()}]);