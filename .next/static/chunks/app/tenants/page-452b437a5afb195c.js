(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8118],{28609:function(e,t,r){Promise.resolve().then(r.bind(r,12727))},12727:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return L}});var n=r(57437),s=r(73044),a=r(2265),l=r(27648),i=r(3612),c=r(66070),o=r(35974),d=r(62869),u=r(95186),h=r(53647),m=r(65613),f=r(93022),x=r(16831),p=r(99397),w=r(49322),j=r(73247),g=r(95805),y=r(67782),v=r(42208),N=r(15868),b=r(18930);let I=(0,r(79205).Z)("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);var E=r(14938),O=r(13041),C=r(31047),S=r(84190),Z=r(87881);function k(e){let{onTenantSelect:t}=e,{user:r}=(0,i.aC)(),[s,k]=(0,a.useState)([]),[L,A]=(0,a.useState)(!0),[z,T]=(0,a.useState)(""),[U,D]=(0,a.useState)(""),[P,J]=(0,a.useState)("all");(0,a.useEffect)(()=>{Q()},[r,P]);let Q=async()=>{if(r){A(!0),T("");try{let e={};"all"!==P&&(e.status=P);let t=await (0,Z.ax)(e);k(t.tenants)}catch(e){T(e.message)}finally{A(!1)}}},_=async()=>{if(!U.trim()){Q();return}A(!0);try{let e=await (0,Z.BF)(U);k(e)}catch(e){T(e.message)}finally{A(!1)}},F=async e=>{if(confirm("Are you sure you want to delete this tenant? This action cannot be undone."))try{await (0,Z.yO)(e),k(t=>t.filter(t=>t.id!==e))}catch(e){T(e.message)}},M=e=>({active:"bg-green-100 text-green-800",notice_period:"bg-yellow-100 text-yellow-800",former:"bg-gray-100 text-gray-800"})[e],R=e=>({active:"Active",notice_period:"Notice Period",former:"Former"})[e],V=e=>(e.personalInfo.emergencyContact.name||"Tenant").split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2);return L&&0===s.length?(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(f.O,{className:"h-8 w-48"}),(0,n.jsx)(f.O,{className:"h-4 w-64 mt-2"})]}),(0,n.jsx)(f.O,{className:"h-10 w-32"})]}),(0,n.jsx)(c.Zb,{children:(0,n.jsx)(c.aY,{className:"pt-6",children:(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsx)(f.O,{className:"h-10 flex-1"}),(0,n.jsx)(f.O,{className:"h-10 w-32"}),(0,n.jsx)(f.O,{className:"h-10 w-32"})]})})}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3].map(e=>(0,n.jsxs)(c.Zb,{children:[(0,n.jsx)(c.Ol,{children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(f.O,{className:"h-12 w-12 rounded-full"}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)(f.O,{className:"h-5 w-32"}),(0,n.jsx)(f.O,{className:"h-4 w-24 mt-1"})]})]})}),(0,n.jsx)(c.aY,{children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)(f.O,{className:"h-4 w-full"}),(0,n.jsx)(f.O,{className:"h-4 w-full"}),(0,n.jsx)(f.O,{className:"h-8 w-full"})]})})]},e))})]}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Tenants"}),(0,n.jsxs)("p",{className:"text-muted-foreground",children:["Manage tenant profiles and information (",s.length," tenants)"]})]}),((null==r?void 0:r.role)==="admin"||(null==r?void 0:r.role)==="agent")&&(0,n.jsx)(d.z,{asChild:!0,children:(0,n.jsxs)(l.default,{href:"/tenants/new",children:[(0,n.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),"Add Tenant"]})})]}),z&&(0,n.jsxs)(m.bZ,{variant:"destructive",children:[(0,n.jsx)(w.Z,{className:"h-4 w-4"}),(0,n.jsx)(m.X,{children:z})]}),(0,n.jsx)(c.Zb,{children:(0,n.jsx)(c.aY,{className:"pt-6",children:(0,n.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(j.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,n.jsx)(u.I,{placeholder:"Search by ID number, occupation, or emergency contact...",className:"pl-8",value:U,onChange:e=>D(e.target.value),onKeyDown:e=>"Enter"===e.key&&_()})]})}),(0,n.jsxs)(h.Ph,{value:P,onValueChange:e=>J(e),children:[(0,n.jsx)(h.i4,{className:"w-[180px]",children:(0,n.jsx)(h.ki,{placeholder:"Status"})}),(0,n.jsxs)(h.Bw,{children:[(0,n.jsx)(h.Ql,{value:"all",children:"All Status"}),(0,n.jsx)(h.Ql,{value:"active",children:"Active"}),(0,n.jsx)(h.Ql,{value:"notice_period",children:"Notice Period"}),(0,n.jsx)(h.Ql,{value:"former",children:"Former"})]})]}),(0,n.jsxs)(d.z,{onClick:_,children:[(0,n.jsx)(j.Z,{className:"mr-2 h-4 w-4"}),"Search"]})]})})}),0!==s.length||L?(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(e=>(0,n.jsxs)(c.Zb,{className:"hover:shadow-lg transition-shadow",children:[(0,n.jsx)(c.Ol,{children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(x.qE,{className:"h-12 w-12",children:(0,n.jsx)(x.Q5,{className:"text-sm font-medium",children:V(e)})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("h3",{className:"font-medium truncate",children:e.personalInfo.emergencyContact.name||"Tenant"}),(0,n.jsxs)("p",{className:"text-sm text-muted-foreground truncate",children:["ID: ",e.personalInfo.idNumber]})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(o.C,{className:M(e.status),children:R(e.status)}),(0,n.jsxs)(S.h_,{children:[(0,n.jsx)(S.$F,{asChild:!0,children:(0,n.jsx)(d.z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:(0,n.jsx)(y.Z,{className:"h-4 w-4"})})}),(0,n.jsxs)(S.AW,{align:"end",children:[(0,n.jsx)(S.Xi,{asChild:!0,children:(0,n.jsxs)(l.default,{href:"/tenants/".concat(e.id),children:[(0,n.jsx)(v.Z,{className:"mr-2 h-4 w-4"}),"View Profile"]})}),((null==r?void 0:r.role)==="admin"||(null==r?void 0:r.role)==="agent")&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S.Xi,{asChild:!0,children:(0,n.jsxs)(l.default,{href:"/tenants/".concat(e.id,"/edit"),children:[(0,n.jsx)(N.Z,{className:"mr-2 h-4 w-4"}),"Edit"]})}),(0,n.jsxs)(S.Xi,{onClick:()=>F(e.id),className:"text-red-600",children:[(0,n.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})]})}),(0,n.jsx)(c.aY,{children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,n.jsx)(I,{className:"w-4 h-4 mr-2 flex-shrink-0"}),(0,n.jsxs)("span",{className:"truncate",children:[e.personalInfo.occupation,e.personalInfo.employer&&" at ".concat(e.personalInfo.employer)]})]}),e.currentUnit&&(0,n.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,n.jsx)(E.Z,{className:"w-4 h-4 mr-2 flex-shrink-0"}),(0,n.jsxs)("span",{children:["Unit: ",e.currentUnit]})]}),(0,n.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,n.jsx)(O.Z,{className:"w-4 h-4 mr-2 flex-shrink-0"}),(0,n.jsx)("span",{className:"truncate",children:e.personalInfo.emergencyContact.phone})]}),(0,n.jsxs)("div",{className:"flex justify-between pt-3 border-t",children:[(0,n.jsxs)(d.z,{variant:"outline",size:"sm",onClick:()=>null==t?void 0:t(e.id),children:[(0,n.jsx)(v.Z,{className:"w-3 h-3 mr-1"}),"View"]}),(0,n.jsx)("div",{className:"space-x-2",children:"active"===e.status&&(0,n.jsx)(d.z,{variant:"outline",size:"sm",asChild:!0,children:(0,n.jsxs)(l.default,{href:"/tenants/".concat(e.id,"/lease"),children:[(0,n.jsx)(C.Z,{className:"w-3 h-3 mr-1"}),"Lease"]})})})]})]})})]},e.id))}):(0,n.jsx)(c.Zb,{children:(0,n.jsxs)(c.aY,{className:"pt-6 text-center",children:[(0,n.jsx)(g.Z,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tenants found"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:U?"No tenants match your search criteria.":"Get started by adding your first tenant."}),((null==r?void 0:r.role)==="admin"||(null==r?void 0:r.role)==="agent")&&!U&&(0,n.jsx)(d.z,{asChild:!0,children:(0,n.jsxs)(l.default,{href:"/tenants/new",children:[(0,n.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),"Add Tenant"]})})]})}),L&&s.length>0&&(0,n.jsx)("div",{className:"text-center py-4",children:(0,n.jsxs)("div",{className:"inline-flex items-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Loading more tenants..."]})})]})}function L(){return(0,n.jsx)(s.Z,{allowedRoles:["admin","agent","owner"],children:(0,n.jsx)(k,{})})}},16831:function(e,t,r){"use strict";r.d(t,{F$:function(){return c},Q5:function(){return o},qE:function(){return i}});var n=r(57437),s=r(2265),a=r(61146),l=r(94508);let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.fC,{ref:t,className:(0,l.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...s})});i.displayName=a.fC.displayName;let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.Ee,{ref:t,className:(0,l.cn)("aspect-square h-full w-full",r),...s})});c.displayName=a.Ee.displayName;let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.NY,{ref:t,className:(0,l.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...s})});o.displayName=a.NY.displayName},48984:function(e,t,r){"use strict";r.d(t,{E2:function(){return l},lK:function(){return c},vw:function(){return i},zI:function(){return o}});var n=r(5978);r(60062);var s=r(17293);let a=(0,n.hJ)(s.db,"properties"),l=async e=>{try{let t=(0,n.JU)(s.db,"properties",e);await (0,n.oe)(t)}catch(e){throw console.error("Error deleting property:",e),e}},i=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=(0,n.IO)(a);e.ownerId&&(t=(0,n.IO)(t,(0,n.ar)("ownerId","==",e.ownerId))),e.assignedAgentId&&(t=(0,n.IO)(t,(0,n.ar)("assignedAgents","array-contains",e.assignedAgentId))),e.type&&(t=(0,n.IO)(t,(0,n.ar)("type","==",e.type))),e.status&&(t=(0,n.IO)(t,(0,n.ar)("status","==",e.status))),t=(0,n.IO)(t,(0,n.Xo)("createdAt","desc")),e.pageSize&&(t=(0,n.IO)(t,(0,n.b9)(e.pageSize))),e.lastDoc&&(t=(0,n.IO)(t,(0,n.TQ)(e.lastDoc)));let r=await (0,n.PL)(t),s=[];return r.forEach(e=>{s.push({id:e.id,...e.data()})}),{properties:s,lastDoc:r.docs[r.docs.length-1],hasMore:r.docs.length===(e.pageSize||0)}}catch(e){throw console.error("Error getting properties:",e),e}},c=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{let r=(0,n.IO)(a,(0,n.ar)("name",">=",e),(0,n.ar)("name","<=",e+"ï£¿"),(0,n.Xo)("name"),t(t)),s=await (0,n.PL)(r),l=[];return s.forEach(e=>{l.push({id:e.id,...e.data()})}),l}catch(e){throw console.error("Error searching properties:",e),e}},o=async(e,t,r)=>{try{let a=(0,n.JU)(s.db,"properties",e);await (0,n.r7)(a,{totalUnits:t,occupiedUnits:r,updatedAt:(0,n.Bt)()})}catch(e){throw console.error("Error updating property occupancy:",e),e}}},87881:function(e,t,r){"use strict";r.d(t,{yO:function(){return f},ax:function(){return x},hk:function(){return w},BF:function(){return p}});var n=r(5978),s=r(17293);r(60062);var a=r(48984);let l=(0,n.hJ)(s.db,"units"),i=async e=>{try{let t=(0,n.JU)(s.db,"units",e),r=await (0,n.QT)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){throw console.error("Error getting unit:",e),e}},c=async e=>{try{let t=(0,n.IO)(l,(0,n.ar)("propertyId","==",e),(0,n.Xo)("label")),r=await (0,n.PL)(t),s=[];return r.forEach(e=>{s.push({id:e.id,...e.data()})}),s}catch(e){throw console.error("Error getting units by property:",e),e}},o=async(e,t,r)=>{try{let a=(0,n.JU)(s.db,"units",e),l={currentTenantId:t,currentLeaseId:r,status:t?"occupied":"vacant",updatedAt:(0,n.Bt)()};await (0,n.r7)(a,l);let c=await i(e);c&&await d(c.propertyId)}catch(e){throw console.error("Error updating unit tenant:",e),e}},d=async e=>{try{let t=await c(e),r=t.filter(e=>"occupied"===e.status).length;await (0,a.zI)(e,t.length,r)}catch(e){throw console.error("Error updating property occupancy stats:",e),e}},u=(0,n.hJ)(s.db,"tenants"),h=async e=>{try{let t=(0,n.JU)(s.db,"tenants",e),r=await (0,n.QT)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){throw console.error("Error getting tenant:",e),e}},m=async(e,t)=>{try{let r=(0,n.JU)(s.db,"tenants",e);await (0,n.r7)(r,t)}catch(e){throw console.error("Error updating tenant:",e),e}},f=async e=>{try{let t=await h(e);if(!t)throw Error("Tenant not found");t.currentUnit&&await o(t.currentUnit,null,null);let r=(0,n.JU)(s.db,"tenants",e);await (0,n.oe)(r)}catch(e){throw console.error("Error deleting tenant:",e),e}},x=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=(0,n.IO)(u);e.status&&(t=(0,n.IO)(t,(0,n.ar)("status","==",e.status))),t=(0,n.IO)(t,(0,n.Xo)("createdAt","desc")),e.pageSize&&(t=(0,n.IO)(t,(0,n.b9)(e.pageSize))),e.lastDoc&&(t=(0,n.IO)(t,(0,n.TQ)(e.lastDoc)));let r=await (0,n.PL)(t),s=[];r.forEach(e=>{s.push({id:e.id,...e.data()})});let a=s;if(e.searchTerm){let t=e.searchTerm.toLowerCase();a=s.filter(e=>e.personalInfo.idNumber.toLowerCase().includes(t)||e.personalInfo.occupation.toLowerCase().includes(t)||e.personalInfo.emergencyContact.name.toLowerCase().includes(t))}return e.propertyId,{tenants:a,lastDoc:r.docs[r.docs.length-1],hasMore:r.docs.length===(e.pageSize||0)}}catch(e){throw console.error("Error getting tenants:",e),e}},p=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{let r=await x({pageSize:100}),n=e.toLowerCase();return r.tenants.filter(e=>e.personalInfo.idNumber.toLowerCase().includes(n)||e.personalInfo.occupation.toLowerCase().includes(n)||e.personalInfo.emergencyContact.name.toLowerCase().includes(n)).slice(0,t)}catch(e){throw console.error("Error searching tenants:",e),e}},w=async e=>{try{let t=await h(e);if(!t||!t.currentUnit)throw Error("Tenant not found or not assigned to a unit");await m(e,{currentUnit:void 0,status:"former"}),await o(t.currentUnit,null,null)}catch(e){throw console.error("Error removing tenant from unit:",e),e}}},13041:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(79205).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},95805:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(79205).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},24369:function(e,t,r){"use strict";var n=r(2265),s="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=n.useState,l=n.useEffect,i=n.useLayoutEffect,c=n.useDebugValue;function o(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!s(e,r)}catch(e){return!0}}var d="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),n=a({inst:{value:r,getSnapshot:t}}),s=n[0].inst,d=n[1];return i(function(){s.value=r,s.getSnapshot=t,o(s)&&d({inst:s})},[e,r,t]),l(function(){return o(s)&&d({inst:s}),e(function(){o(s)&&d({inst:s})})},[e]),c(r),r};t.useSyncExternalStore=void 0!==n.useSyncExternalStore?n.useSyncExternalStore:d},82558:function(e,t,r){"use strict";e.exports=r(24369)},61146:function(e,t,r){"use strict";r.d(t,{NY:function(){return I},Ee:function(){return b},fC:function(){return N}});var n=r(2265),s=r(73966),a=r(26606),l=r(61188),i=r(66840),c=r(82558);function o(){return()=>{}}var d=r(57437),u="Avatar",[h,m]=(0,s.b)(u),[f,x]=h(u),p=n.forwardRef((e,t)=>{let{__scopeAvatar:r,...s}=e,[a,l]=n.useState("idle");return(0,d.jsx)(f,{scope:r,imageLoadingStatus:a,onImageLoadingStatusChange:l,children:(0,d.jsx)(i.WV.span,{...s,ref:t})})});p.displayName=u;var w="AvatarImage",j=n.forwardRef((e,t)=>{let{__scopeAvatar:r,src:s,onLoadingStatusChange:u=()=>{},...h}=e,m=x(w,r),f=function(e,t){let{referrerPolicy:r,crossOrigin:s}=t,a=(0,c.useSyncExternalStore)(o,()=>!0,()=>!1),i=n.useRef(null),d=a?(i.current||(i.current=new window.Image),i.current):null,[u,h]=n.useState(()=>v(d,e));return(0,l.b)(()=>{h(v(d,e))},[d,e]),(0,l.b)(()=>{let e=e=>()=>{h(e)};if(!d)return;let t=e("loaded"),n=e("error");return d.addEventListener("load",t),d.addEventListener("error",n),r&&(d.referrerPolicy=r),"string"==typeof s&&(d.crossOrigin=s),()=>{d.removeEventListener("load",t),d.removeEventListener("error",n)}},[d,s,r]),u}(s,h),p=(0,a.W)(e=>{u(e),m.onImageLoadingStatusChange(e)});return(0,l.b)(()=>{"idle"!==f&&p(f)},[f,p]),"loaded"===f?(0,d.jsx)(i.WV.img,{...h,ref:t,src:s}):null});j.displayName=w;var g="AvatarFallback",y=n.forwardRef((e,t)=>{let{__scopeAvatar:r,delayMs:s,...a}=e,l=x(g,r),[c,o]=n.useState(void 0===s);return n.useEffect(()=>{if(void 0!==s){let e=window.setTimeout(()=>o(!0),s);return()=>window.clearTimeout(e)}},[s]),c&&"loaded"!==l.imageLoadingStatus?(0,d.jsx)(i.WV.span,{...a,ref:t}):null});function v(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}y.displayName=g;var N=p,b=j,I=y}},function(e){e.O(0,[4358,139,92,5189,7746,4193,2972,3774,9984,2982,3940,2971,2117,1744],function(){return e(e.s=28609)}),_N_E=e.O()}]);