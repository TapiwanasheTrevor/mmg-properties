(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5368,6749],{40278:function(e,s,a){Promise.resolve().then(a.bind(a,88870))},88870:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return E}});var t=a(57437),l=a(73044),n=a(2265),i=a(27648),r=a(3612),c=a(66070),d=a(35974),o=a(62869),h=a(95186),u=a(53647),m=a(65613),x=a(93022),g=a(91723),j=a(92369),p=a(29525),y=a(49322),v=a(41671);let w=(0,a(79205).Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var N=a(76865),f=a(99397),b=a(73247),C=a(31047),Z=a(14938),O=a(42208),q=a(67782),I=a(15868),Q=a(18930),k=a(84190),S=a(43426),_=a(66749);function A(e){let{onRequestSelect:s,propertyId:a,unitId:l,showFilters:A=!0}=e,{user:E}=(0,r.aC)(),[T,z]=(0,n.useState)([]),[P,B]=(0,n.useState)(!0),[D,R]=(0,n.useState)(""),[X,L]=(0,n.useState)(""),[M,V]=(0,n.useState)("all"),[Y,J]=(0,n.useState)("all"),[U,W]=(0,n.useState)("all");(0,n.useEffect)(()=>{$()},[E,M,Y,U,a,l]);let $=async()=>{if(E){B(!0),R("");try{let e={};"all"!==M&&(e.status=M),"all"!==Y&&(e.priority=Y),"all"!==U&&(e.category=U),a&&(e.propertyId=a),l&&(e.unitId=l),"tenant"===E.role?e.submittedBy=E.id:"agent"===E.role&&(e.assignedTo=E.id);let s=await (0,_.eD)(e);z(s.requests)}catch(e){R(e.message)}finally{B(!1)}}},F=async e=>{if(confirm("Are you sure you want to delete this maintenance request? This action cannot be undone."))try{await (0,_.hm)(e),z(s=>s.filter(s=>s.id!==e))}catch(e){R(e.message)}},G=async(e,s)=>{try{await (0,_.ty)(e,s),z(a=>a.map(a=>a.id===e?{...a,status:s}:a))}catch(e){R(e.message)}},H=T.filter(e=>{if(!X)return!0;let s=X.toLowerCase();return e.title.toLowerCase().includes(s)||e.description.toLowerCase().includes(s)||e.category.toLowerCase().includes(s)}),K=e=>({pending:"bg-yellow-100 text-yellow-800",assigned:"bg-blue-100 text-blue-800",in_progress:"bg-orange-100 text-orange-800",awaiting_approval:"bg-purple-100 text-purple-800",completed:"bg-green-100 text-green-800",cancelled:"bg-gray-100 text-gray-800"})[e],ee=e=>({pending:g.Z,assigned:j.Z,in_progress:p.Z,awaiting_approval:y.Z,completed:v.Z,cancelled:w})[e],es=e=>({low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",emergency:"bg-red-100 text-red-800"})[e],ea=e=>"emergency"===e?N.Z:null,et=e=>(null==E?void 0:E.role)==="admin"||(null==E?void 0:E.id)===e.submittedBy||(null==E?void 0:E.role)==="agent"&&e.assignedTo===E.id,el=e=>(null==E?void 0:E.role)==="admin"||(null==E?void 0:E.id)===e.submittedBy&&"pending"===e.status;return P&&0===T.length?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(x.O,{className:"h-8 w-48"}),(0,t.jsx)(x.O,{className:"h-4 w-64 mt-2"})]}),(0,t.jsx)(x.O,{className:"h-10 w-32"})]}),A&&(0,t.jsx)(c.Zb,{children:(0,t.jsx)(c.aY,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)(x.O,{className:"h-10 flex-1"}),(0,t.jsx)(x.O,{className:"h-10 w-32"}),(0,t.jsx)(x.O,{className:"h-10 w-32"})]})})}),(0,t.jsx)("div",{className:"grid grid-cols-1 gap-4",children:[1,2,3].map(e=>(0,t.jsx)(c.Zb,{children:(0,t.jsx)(c.aY,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,t.jsx)(x.O,{className:"h-6 w-16"}),(0,t.jsx)(x.O,{className:"h-6 w-20"})]}),(0,t.jsx)(x.O,{className:"h-5 w-64 mb-2"}),(0,t.jsx)(x.O,{className:"h-4 w-full"})]}),(0,t.jsx)(x.O,{className:"h-8 w-8"})]})})},e))})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Maintenance Requests"}),(0,t.jsxs)("p",{className:"text-muted-foreground",children:["Manage maintenance and service requests (",T.length," requests)"]})]}),((null==E?void 0:E.role)==="admin"||(null==E?void 0:E.role)==="agent"||(null==E?void 0:E.role)==="tenant")&&(0,t.jsx)(o.z,{asChild:!0,children:(0,t.jsxs)(i.default,{href:"/maintenance/new",children:[(0,t.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"New Request"]})})]}),D&&(0,t.jsxs)(m.bZ,{variant:"destructive",children:[(0,t.jsx)(y.Z,{className:"h-4 w-4"}),(0,t.jsx)(m.X,{children:D})]}),A&&(0,t.jsx)(c.Zb,{children:(0,t.jsx)(c.aY,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(b.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(h.I,{placeholder:"Search requests by title, description, or category...",className:"pl-8",value:X,onChange:e=>L(e.target.value)})]})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(u.Ph,{value:M,onValueChange:e=>V(e),children:[(0,t.jsx)(u.i4,{className:"w-[140px]",children:(0,t.jsx)(u.ki,{placeholder:"Status"})}),(0,t.jsxs)(u.Bw,{children:[(0,t.jsx)(u.Ql,{value:"all",children:"All Status"}),(0,t.jsx)(u.Ql,{value:"pending",children:"Pending"}),(0,t.jsx)(u.Ql,{value:"assigned",children:"Assigned"}),(0,t.jsx)(u.Ql,{value:"in_progress",children:"In Progress"}),(0,t.jsx)(u.Ql,{value:"completed",children:"Completed"}),(0,t.jsx)(u.Ql,{value:"cancelled",children:"Cancelled"})]})]}),(0,t.jsxs)(u.Ph,{value:Y,onValueChange:e=>J(e),children:[(0,t.jsx)(u.i4,{className:"w-[140px]",children:(0,t.jsx)(u.ki,{placeholder:"Priority"})}),(0,t.jsxs)(u.Bw,{children:[(0,t.jsx)(u.Ql,{value:"all",children:"All Priority"}),(0,t.jsx)(u.Ql,{value:"emergency",children:"Emergency"}),(0,t.jsx)(u.Ql,{value:"high",children:"High"}),(0,t.jsx)(u.Ql,{value:"medium",children:"Medium"}),(0,t.jsx)(u.Ql,{value:"low",children:"Low"})]})]}),(0,t.jsxs)(u.Ph,{value:U,onValueChange:e=>W(e),children:[(0,t.jsx)(u.i4,{className:"w-[140px]",children:(0,t.jsx)(u.ki,{placeholder:"Category"})}),(0,t.jsxs)(u.Bw,{children:[(0,t.jsx)(u.Ql,{value:"all",children:"All Categories"}),(0,t.jsx)(u.Ql,{value:"plumbing",children:"Plumbing"}),(0,t.jsx)(u.Ql,{value:"electrical",children:"Electrical"}),(0,t.jsx)(u.Ql,{value:"structural",children:"Structural"}),(0,t.jsx)(u.Ql,{value:"appliance",children:"Appliance"}),(0,t.jsx)(u.Ql,{value:"cleaning",children:"Cleaning"}),(0,t.jsx)(u.Ql,{value:"other",children:"Other"})]})]})]})]})})}),0!==H.length||P?(0,t.jsx)("div",{className:"space-y-4",children:H.map(e=>{let a=ee(e.status),l=ea(e.priority);return(0,t.jsx)(c.Zb,{className:"hover:shadow-lg transition-shadow",children:(0,t.jsx)(c.aY,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,t.jsxs)(d.C,{className:K(e.status),children:[(0,t.jsx)(a,{className:"w-3 h-3 mr-1"}),e.status.replace("_"," ")]}),(0,t.jsxs)(d.C,{className:es(e.priority),children:[l&&(0,t.jsx)(l,{className:"w-3 h-3 mr-1"}),e.priority]}),(0,t.jsx)(d.C,{variant:"outline",children:e.category})]}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2 line-clamp-1",children:e.title}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm mb-3 line-clamp-2",children:e.description}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4 text-sm text-muted-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(C.Z,{className:"w-4 h-4 mr-1"}),(0,t.jsx)("span",{children:(0,S.Q)(e.createdAt.toDate(),{addSuffix:!0})})]}),e.unitId&&(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(Z.Z,{className:"w-4 h-4 mr-1"}),(0,t.jsxs)("span",{children:["Unit ",e.unitId.slice(0,8),"..."]})]}),e.assignedTo&&(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(j.Z,{className:"w-4 h-4 mr-1"}),(0,t.jsx)("span",{children:"Assigned"})]}),e.estimatedCost&&e.estimatedCost>0&&(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsxs)("span",{className:"font-medium",children:["$",e.estimatedCost.toLocaleString()]})})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,t.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>null==s?void 0:s(e.id),children:[(0,t.jsx)(O.Z,{className:"w-4 h-4 mr-1"}),"View"]}),(0,t.jsxs)(k.h_,{children:[(0,t.jsx)(k.$F,{asChild:!0,children:(0,t.jsx)(o.z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:(0,t.jsx)(q.Z,{className:"h-4 w-4"})})}),(0,t.jsxs)(k.AW,{align:"end",children:[(0,t.jsx)(k.Xi,{asChild:!0,children:(0,t.jsxs)(i.default,{href:"/maintenance/".concat(e.id),children:[(0,t.jsx)(O.Z,{className:"mr-2 h-4 w-4"}),"View Details"]})}),et(e)&&(0,t.jsx)(k.Xi,{asChild:!0,children:(0,t.jsxs)(i.default,{href:"/maintenance/".concat(e.id,"/edit"),children:[(0,t.jsx)(I.Z,{className:"mr-2 h-4 w-4"}),"Edit"]})}),((null==E?void 0:E.role)==="admin"||(null==E?void 0:E.role)==="agent")&&"pending"===e.status&&(0,t.jsxs)(k.Xi,{onClick:()=>G(e.id,"assigned"),children:[(0,t.jsx)(j.Z,{className:"mr-2 h-4 w-4"}),"Assign to Me"]}),e.assignedTo===(null==E?void 0:E.id)&&"assigned"===e.status&&(0,t.jsxs)(k.Xi,{onClick:()=>G(e.id,"in_progress"),children:[(0,t.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),"Start Work"]}),e.assignedTo===(null==E?void 0:E.id)&&"in_progress"===e.status&&(0,t.jsxs)(k.Xi,{onClick:()=>G(e.id,"completed"),children:[(0,t.jsx)(v.Z,{className:"mr-2 h-4 w-4"}),"Mark Complete"]}),el(e)&&(0,t.jsxs)(k.Xi,{onClick:()=>F(e.id),className:"text-red-600",children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})})},e.id)})}):(0,t.jsx)(c.Zb,{children:(0,t.jsxs)(c.aY,{className:"pt-6 text-center",children:[(0,t.jsx)(p.Z,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No maintenance requests found"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:X?"No requests match your search criteria.":"Get started by submitting a maintenance request."}),!X&&((null==E?void 0:E.role)==="admin"||(null==E?void 0:E.role)==="agent"||(null==E?void 0:E.role)==="tenant")&&(0,t.jsx)(o.z,{asChild:!0,children:(0,t.jsxs)(i.default,{href:"/maintenance/new",children:[(0,t.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"New Request"]})})]})}),P&&T.length>0&&(0,t.jsx)("div",{className:"text-center py-4",children:(0,t.jsxs)("div",{className:"inline-flex items-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Loading more requests..."]})})]})}function E(){return(0,t.jsx)(l.Z,{allowedRoles:["admin","agent","owner","tenant"],children:(0,t.jsx)(A,{})})}},66749:function(e,s,a){"use strict";a.d(s,{eD:function(){return c},getAssignedRequests:function(){return u},getOverdueRequests:function(){return m},getPendingRequests:function(){return h},hm:function(){return r},ty:function(){return d}});var t=a(5978),l=a(17293);let n=(0,t.hJ)(l.db,"maintenanceRequests"),i=async(e,s)=>{try{let a=(0,t.JU)(l.db,"maintenanceRequests",e);await (0,t.r7)(a,s)}catch(e){throw console.error("Error updating maintenance request:",e),e}},r=async e=>{try{let s=(0,t.JU)(l.db,"maintenanceRequests",e);await (0,t.oe)(s)}catch(e){throw console.error("Error deleting maintenance request:",e),e}},c=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let s=(0,t.IO)(n);e.status&&(s=(0,t.IO)(s,(0,t.ar)("status","==",e.status))),e.priority&&(s=(0,t.IO)(s,(0,t.ar)("priority","==",e.priority))),e.category&&(s=(0,t.IO)(s,(0,t.ar)("category","==",e.category))),e.type&&(s=(0,t.IO)(s,(0,t.ar)("type","==",e.type))),e.propertyId&&(s=(0,t.IO)(s,(0,t.ar)("propertyId","==",e.propertyId))),e.unitId&&(s=(0,t.IO)(s,(0,t.ar)("unitId","==",e.unitId))),e.submittedBy&&(s=(0,t.IO)(s,(0,t.ar)("submittedBy","==",e.submittedBy))),e.assignedTo&&(s=(0,t.IO)(s,(0,t.ar)("assignedTo","==",e.assignedTo))),s=(0,t.IO)(s,(0,t.Xo)("createdAt","desc")),e.pageSize&&(s=(0,t.IO)(s,(0,t.b9)(e.pageSize))),e.lastDoc&&(s=(0,t.IO)(s,(0,t.TQ)(e.lastDoc)));let a=await (0,t.PL)(s),l=[];return a.forEach(e=>{l.push({id:e.id,...e.data()})}),{requests:l,lastDoc:a.docs[a.docs.length-1],hasMore:a.docs.length===(e.pageSize||0)}}catch(e){throw console.error("Error getting maintenance requests:",e),e}},d=async(e,s,a)=>{try{let l={status:s,...a};"completed"===s&&(l.completedAt=(0,t.Bt)()),await i(e,l)}catch(e){throw console.error("Error updating maintenance request status:",e),e}},o=async e=>(await c({status:e})).requests,h=async()=>o("pending"),u=async e=>(await c({assignedTo:e})).requests,m=async()=>{try{let e=await o("assigned"),s=await o("in_progress"),a=[...e,...s],t=new Date;return a.filter(e=>{if(!e.assignedAt)return!1;let s=e.assignedAt.toDate(),a=(t.getTime()-s.getTime())/36e5,l="emergency"===e.priority?4:"high"===e.priority?48:72;return a>l})}catch(e){throw console.error("Error getting overdue requests:",e),e}}},29525:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(79205).Z)("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]])}},function(e){e.O(0,[4358,139,92,5189,7746,3825,4193,2972,3774,5523,9984,2982,3940,2971,2117,1744],function(){return e(e.s=40278)}),_N_E=e.O()}]);