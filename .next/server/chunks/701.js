"use strict";exports.id=701,exports.ids=[701],exports.modules={81075:(e,s,a)=>{a.d(s,{default:()=>G});var r=a(10326),t=a(17577),l=a(35047),n=a(90434),i=a(19395),c=a(2991),d=a(90772),o=a(28758),h=a(567),x=a(60097),m=a(29798),f=a(38787),u=a(76464),j=a(24061),p=a(36283),g=a(67048),N=a(71821),w=a(37358),b=a(39730),y=a(39183),v=a(11890),C=a(88378),Z=a(6507),z=a(71810);let D=[{title:"Dashboard",href:"/dashboard",icon:m.Z,roles:["admin","owner","agent","tenant"]},{title:"Properties",href:"/properties",icon:f.Z,roles:["admin","owner","agent"]},{title:"Units",href:"/units",icon:u.Z,roles:["admin","owner","agent"]},{title:"Tenants",href:"/tenants",icon:j.Z,roles:["admin","owner","agent"]},{title:"Leases",href:"/leases",icon:p.Z,roles:["admin","owner","agent"]},{title:"Maintenance",href:"/maintenance",icon:g.Z,roles:["admin","owner","agent","tenant"]},{title:"Financials",href:"/financials",icon:N.Z,roles:["admin","owner"]},{title:"Reports",href:"/reports",icon:u.Z,roles:["admin","owner"]},{title:"Schedule",href:"/schedule",icon:w.Z,roles:["admin","agent"]},{title:"Messages",href:"/messages",icon:b.Z,roles:["admin","owner","agent","tenant"]}];function A({collapsed:e,onToggle:s}){let{user:a}=(0,i.aC)(),t=(0,l.usePathname)(),m=async()=>{try{await (0,c.kS)(),window.location.href="/login"}catch(e){console.error("Error logging out:",e)}},u=D.filter(e=>e.roles.includes(a?.role||""));return a?(0,r.jsxs)("div",{className:`bg-white border-r border-gray-200 flex flex-col transition-all duration-300 ${e?"w-16":"w-64"}`,children:[r.jsx("div",{className:"p-4 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[!e&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:r.jsx(f.Z,{className:"w-5 h-5 text-white"})}),r.jsx("span",{className:"font-bold text-lg",children:"MMG"})]}),r.jsx(d.z,{variant:"ghost",size:"sm",onClick:s,className:"p-1 h-8 w-8",children:e?r.jsx(y.Z,{className:"h-4 w-4"}):r.jsx(v.Z,{className:"h-4 w-4"})})]})}),r.jsx("div",{className:"p-4 border-b border-gray-200",children:(0,r.jsxs)(x.h_,{children:[r.jsx(x.$F,{asChild:!0,children:r.jsx(d.z,{variant:"ghost",className:"w-full justify-start p-2 h-auto",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)(o.qE,{className:"h-8 w-8",children:[r.jsx(o.F$,{src:a.profile.avatar}),(0,r.jsxs)(o.Q5,{children:[a.profile.firstName.charAt(0),a.profile.lastName.charAt(0)]})]}),!e&&(0,r.jsxs)("div",{className:"flex-1 text-left",children:[(0,r.jsxs)("p",{className:"text-sm font-medium",children:[a.profile.firstName," ",a.profile.lastName]}),r.jsx(h.C,{variant:"secondary",className:`text-xs ${(e=>{switch(e){case"admin":return"bg-red-100 text-red-800";case"owner":return"bg-blue-100 text-blue-800";case"agent":return"bg-green-100 text-green-800";case"tenant":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}})(a.role)}`,children:(e=>{switch(e){case"admin":return"Administrator";case"owner":return"Property Owner";case"agent":return"Agent";case"tenant":return"Tenant";default:return e}})(a.role)})]})]})})}),(0,r.jsxs)(x.AW,{className:"w-56",align:"end",children:[r.jsx(x.Ju,{children:"My Account"}),r.jsx(x.VD,{}),r.jsx(x.Xi,{asChild:!0,children:(0,r.jsxs)(n.default,{href:"/profile",children:[r.jsx(C.Z,{className:"mr-2 h-4 w-4"}),"Profile Settings"]})}),r.jsx(x.Xi,{asChild:!0,children:(0,r.jsxs)(n.default,{href:"/notifications",children:[r.jsx(Z.Z,{className:"mr-2 h-4 w-4"}),"Notifications"]})}),r.jsx(x.VD,{}),(0,r.jsxs)(x.Xi,{onClick:m,className:"text-red-600",children:[r.jsx(z.Z,{className:"mr-2 h-4 w-4"}),"Log out"]})]})]})}),r.jsx("nav",{className:"flex-1 p-2 space-y-1",children:u.map(s=>{let a=t===s.href||t.startsWith(s.href+"/"),l=s.icon;return r.jsx(n.default,{href:s.href,children:(0,r.jsxs)(d.z,{variant:a?"secondary":"ghost",className:`w-full justify-start ${e?"px-2":"px-3"} ${a?"bg-blue-50 text-blue-700":""}`,children:[r.jsx(l,{className:"h-4 w-4"}),!e&&r.jsx("span",{className:"ml-3",children:s.title})]})},s.href)})}),!e&&r.jsx("div",{className:"p-4 border-t border-gray-200",children:r.jsx("div",{className:"text-xs text-gray-500 text-center",children:"\xa9 2024 MMG Property Consultancy"})})]}):null}var E=a(54432),S=a(88307),O=a(83855),I=a(79635),k=a(74964),M=a(77863);let R=k.fC,$=k.xz,P=t.forwardRef(({className:e,align:s="center",sideOffset:a=4,...t},l)=>r.jsx(k.h_,{children:r.jsx(k.VY,{ref:l,align:s,sideOffset:a,className:(0,M.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})}));P.displayName=k.VY.displayName;var q=a(16999);let _=t.forwardRef(({className:e,children:s,...a},t)=>(0,r.jsxs)(q.fC,{ref:t,className:(0,M.cn)("relative overflow-hidden",e),...a,children:[r.jsx(q.l_,{className:"h-full w-full rounded-[inherit]",children:s}),r.jsx(F,{}),r.jsx(q.Ns,{})]}));_.displayName=q.fC.displayName;let F=t.forwardRef(({className:e,orientation:s="vertical",...a},t)=>r.jsx(q.gb,{ref:t,orientation:s,className:(0,M.cn)("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...a,children:r.jsx(q.q4,{className:"relative flex-1 rounded-full bg-border"})}));F.displayName=q.gb.displayName;var X=a(8281),J=a(45804),V=a(76),T=a(20902);a(19008),(0,V.hJ)(T.db,"notifications");let L=async e=>{try{let s=(0,V.JU)(T.db,"notifications",e);await (0,V.r7)(s,{read:!0})}catch(e){throw console.error("Error marking notification as read:",e),e}};function Q(){let{user:e}=(0,i.aC)(),[s,a]=(0,t.useState)([]),[l,n]=(0,t.useState)(!1),[c,o]=(0,t.useState)(!1),x=async e=>{if(!e.read)try{await L(e.id),a(s=>s.map(s=>s.id===e.id?{...s,read:!0}:s))}catch(e){console.error("Error marking notification as read:",e)}},m=s.filter(e=>!e.read).length,f=e=>{switch(e){case"high":return"text-red-600";case"medium":return"text-yellow-600";default:return"text-blue-600"}},u=e=>{switch(e){case"lease_expiring":case"lease_expired":return"\uD83D\uDCCB";case"payment_due":return"\uD83D\uDCB0";case"maintenance_request":return"\uD83D\uDD27";default:return"\uD83D\uDCE2"}};return(0,r.jsxs)(R,{open:c,onOpenChange:o,children:[r.jsx($,{asChild:!0,children:(0,r.jsxs)(d.z,{variant:"ghost",size:"sm",className:"relative",children:[r.jsx(Z.Z,{className:"h-4 w-4"}),m>0&&r.jsx(h.C,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center text-xs p-0",children:m>99?"99+":m})]})}),r.jsx(P,{className:"w-80",align:"end",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("h4",{className:"font-semibold",children:"Notifications"}),m>0&&(0,r.jsxs)(h.C,{variant:"secondary",children:[m," unread"]})]}),r.jsx(X.Z,{}),r.jsx(_,{className:"h-[300px]",children:l?r.jsx("div",{className:"flex items-center justify-center py-6",children:r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):0===s.length?r.jsx("div",{className:"text-center py-6 text-sm text-muted-foreground",children:"No notifications yet"}):r.jsx("div",{className:"space-y-2",children:s.map(e=>r.jsx("div",{className:`p-3 rounded-lg border cursor-pointer transition-colors ${e.read?"bg-gray-50 border-gray-200":"bg-blue-50 border-blue-200 hover:bg-blue-100"}`,onClick:()=>x(e),children:(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[r.jsx("span",{className:"text-lg",children:u(e.type)}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("h5",{className:`text-sm font-medium ${f(e.priority)}`,children:e.title}),!e.read&&r.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full"})]}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:e.message}),r.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:(0,J.WU)(e.createdAt.toDate(),"MMM dd, HH:mm")})]})]})},e.id))})}),s.length>0&&(0,r.jsxs)(r.Fragment,{children:[r.jsx(X.Z,{}),r.jsx(d.z,{variant:"ghost",size:"sm",className:"w-full",children:"View all notifications"})]})]})})]})}function U({title:e,actions:s}){let{user:a}=(0,i.aC)(),[l,h]=(0,t.useState)(""),m=async()=>{try{await (0,c.kS)(),window.location.href="/login"}catch(e){console.error("Error logging out:",e)}},u=(()=>{if(!a)return[];let e=[];switch(a.role){case"admin":case"owner":e.push({label:"Add Property",href:"/properties/new",icon:f.Z},{label:"Add Tenant",href:"/tenants/new",icon:j.Z},{label:"New Maintenance",href:"/maintenance/new",icon:g.Z});break;case"agent":e.push({label:"Add Tenant",href:"/tenants/new",icon:j.Z},{label:"New Maintenance",href:"/maintenance/new",icon:g.Z});break;case"tenant":e.push({label:"Request Maintenance",href:"/maintenance/new",icon:g.Z})}return e})();return a?r.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4 flex-1",children:[e&&r.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:e}),r.jsx("div",{className:"max-w-md w-full",children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),console.log("Searching for:",l)},className:"relative",children:[r.jsx(S.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),r.jsx(E.I,{type:"text",placeholder:"Search properties, tenants, requests...",value:l,onChange:e=>h(e.target.value),className:"pl-10 pr-4"})]})})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[s&&r.jsx("div",{className:"flex items-center space-x-2",children:s}),u.length>0&&(0,r.jsxs)(x.h_,{children:[r.jsx(x.$F,{asChild:!0,children:(0,r.jsxs)(d.z,{size:"sm",className:"h-9",children:[r.jsx(O.Z,{className:"h-4 w-4 mr-2"}),"New"]})}),(0,r.jsxs)(x.AW,{className:"w-48",align:"end",children:[r.jsx(x.Ju,{children:"Quick Actions"}),r.jsx(x.VD,{}),u.map(e=>r.jsx(x.Xi,{asChild:!0,children:(0,r.jsxs)(n.default,{href:e.href,children:[r.jsx(e.icon,{className:"mr-2 h-4 w-4"}),e.label]})},e.href))]})]}),r.jsx(Q,{}),r.jsx(d.z,{variant:"ghost",size:"sm",className:"h-9 w-9 p-0",asChild:!0,children:r.jsx(n.default,{href:"/messages",children:r.jsx(b.Z,{className:"h-4 w-4"})})}),(0,r.jsxs)(x.h_,{children:[r.jsx(x.$F,{asChild:!0,children:(0,r.jsxs)(d.z,{variant:"ghost",className:"h-9 px-2",children:[(0,r.jsxs)(o.qE,{className:"h-6 w-6 mr-2",children:[r.jsx(o.F$,{src:a.profile.avatar}),(0,r.jsxs)(o.Q5,{className:"text-xs",children:[a.profile.firstName.charAt(0),a.profile.lastName.charAt(0)]})]}),r.jsx("span",{className:"hidden md:inline text-sm",children:a.profile.firstName})]})}),(0,r.jsxs)(x.AW,{className:"w-56",align:"end",children:[r.jsx(x.Ju,{children:(0,r.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,r.jsxs)("div",{className:"font-medium",children:[a.profile.firstName," ",a.profile.lastName]}),r.jsx("div",{className:"text-xs text-gray-500",children:a.email})]})}),r.jsx(x.VD,{}),r.jsx(x.Xi,{asChild:!0,children:(0,r.jsxs)(n.default,{href:"/profile",children:[r.jsx(I.Z,{className:"mr-2 h-4 w-4"}),"Profile"]})}),r.jsx(x.Xi,{asChild:!0,children:(0,r.jsxs)(n.default,{href:"/settings",children:[r.jsx(C.Z,{className:"mr-2 h-4 w-4"}),"Settings"]})}),r.jsx(x.VD,{}),(0,r.jsxs)(x.Xi,{onClick:m,className:"text-red-600",children:[r.jsx(z.Z,{className:"mr-2 h-4 w-4"}),"Log out"]})]})]})]})]})}):null}var W=a(43888),Y=a(65304);function B({children:e,allowedRoles:s,requiredPermissions:a,requireAllPermissions:n=!1,redirectTo:c="/login",fallbackComponent:d}){let{user:o,firebaseUser:h,loading:x,error:m,mfaRequired:f,permissionsLoaded:u}=(0,i.aC)(),j=(0,l.useRouter)(),p=(0,l.usePathname)(),[g,N]=(0,t.useState)(!1),[w,b]=(0,t.useState)(!1);return!x&&u&&g?m?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("h2",{className:"text-xl font-semibold text-red-600 mb-2",children:"Authentication Error"}),(0,r.jsxs)("p",{className:"text-gray-600 mb-4",children:["There was an error loading your account: ",m.message]}),r.jsx("button",{onClick:()=>j.push("/login"),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Return to Login"})]})}):!h||!o||!o.isActive||(0,W.Y_)(p)&&f?null:w?r.jsx(r.Fragment,{children:e}):d?r.jsx(d,{}):null:r.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto space-y-4",children:[r.jsx(Y.O,{className:"h-8 w-64"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[r.jsx(Y.O,{className:"h-32"}),r.jsx(Y.O,{className:"h-32"}),r.jsx(Y.O,{className:"h-32"})]}),r.jsx(Y.O,{className:"h-64"})]})})}function G({children:e,title:s,headerActions:a,requiredRoles:l,requiredPermissions:n}){let[i,c]=(0,t.useState)(!1);return r.jsx(B,{requiredRoles:l,requiredPermissions:n,children:(0,r.jsxs)("div",{className:"h-screen flex bg-gray-50",children:[r.jsx(A,{collapsed:i,onToggle:()=>c(!i)}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[r.jsx(U,{title:s,actions:a}),r.jsx("main",{className:"flex-1 overflow-y-auto",children:e})]})]})})}},28758:(e,s,a)=>{a.d(s,{F$:()=>c,Q5:()=>d,qE:()=>i});var r=a(10326),t=a(17577),l=a(42851),n=a(77863);let i=t.forwardRef(({className:e,...s},a)=>r.jsx(l.fC,{ref:a,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...s}));i.displayName=l.fC.displayName;let c=t.forwardRef(({className:e,...s},a)=>r.jsx(l.Ee,{ref:a,className:(0,n.cn)("aspect-square h-full w-full",e),...s}));c.displayName=l.Ee.displayName;let d=t.forwardRef(({className:e,...s},a)=>r.jsx(l.NY,{ref:a,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...s}));d.displayName=l.NY.displayName},8281:(e,s,a)=>{a.d(s,{Z:()=>i});var r=a(10326),t=a(17577),l=a(90220),n=a(77863);let i=t.forwardRef(({className:e,orientation:s="horizontal",decorative:a=!0,...t},i)=>r.jsx(l.f,{ref:i,decorative:a,orientation:s,className:(0,n.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",e),...t}));i.displayName=l.f.displayName},54041:(e,s,a)=>{a.d(s,{E2:()=>n,lK:()=>c,vw:()=>i,zI:()=>d});var r=a(76);a(11552);var t=a(20902);let l=(0,r.hJ)(t.db,"properties"),n=async e=>{try{let s=(0,r.JU)(t.db,"properties",e);await (0,r.oe)(s)}catch(e){throw console.error("Error deleting property:",e),e}},i=async(e={})=>{try{let s=(0,r.IO)(l);e.ownerId&&(s=(0,r.IO)(s,(0,r.ar)("ownerId","==",e.ownerId))),e.assignedAgentId&&(s=(0,r.IO)(s,(0,r.ar)("assignedAgents","array-contains",e.assignedAgentId))),e.type&&(s=(0,r.IO)(s,(0,r.ar)("type","==",e.type))),e.status&&(s=(0,r.IO)(s,(0,r.ar)("status","==",e.status))),s=(0,r.IO)(s,(0,r.Xo)("createdAt","desc")),e.pageSize&&(s=(0,r.IO)(s,(0,r.b9)(e.pageSize))),e.lastDoc&&(s=(0,r.IO)(s,(0,r.TQ)(e.lastDoc)));let a=await (0,r.PL)(s),t=[];return a.forEach(e=>{t.push({id:e.id,...e.data()})}),{properties:t,lastDoc:a.docs[a.docs.length-1],hasMore:a.docs.length===(e.pageSize||0)}}catch(e){throw console.error("Error getting properties:",e),e}},c=async(e,s=10)=>{try{let a=(0,r.IO)(l,(0,r.ar)("name",">=",e),(0,r.ar)("name","<=",e+""),(0,r.Xo)("name"),s(s)),t=await (0,r.PL)(a),n=[];return t.forEach(e=>{n.push({id:e.id,...e.data()})}),n}catch(e){throw console.error("Error searching properties:",e),e}},d=async(e,s,a)=>{try{let l=(0,r.JU)(t.db,"properties",e);await (0,r.r7)(l,{totalUnits:s,occupiedUnits:a,updatedAt:(0,r.Bt)()})}catch(e){throw console.error("Error updating property occupancy:",e),e}}}};