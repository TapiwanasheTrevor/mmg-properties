(()=>{var e={};e.id=368,e.ids=[368,546],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},98061:e=>{"use strict";e.exports=require("node:assert")},92761:e=>{"use strict";e.exports=require("node:async_hooks")},72254:e=>{"use strict";e.exports=require("node:buffer")},40027:e=>{"use strict";e.exports=require("node:console")},6005:e=>{"use strict";e.exports=require("node:crypto")},65714:e=>{"use strict";e.exports=require("node:diagnostics_channel")},15673:e=>{"use strict";e.exports=require("node:events")},88849:e=>{"use strict";e.exports=require("node:http")},42725:e=>{"use strict";e.exports=require("node:http2")},87503:e=>{"use strict";e.exports=require("node:net")},38846:e=>{"use strict";e.exports=require("node:perf_hooks")},39630:e=>{"use strict";e.exports=require("node:querystring")},84492:e=>{"use strict";e.exports=require("node:stream")},31764:e=>{"use strict";e.exports=require("node:tls")},41041:e=>{"use strict";e.exports=require("node:url")},47261:e=>{"use strict";e.exports=require("node:util")},93746:e=>{"use strict";e.exports=require("node:util/types")},24086:e=>{"use strict";e.exports=require("node:worker_threads")},65628:e=>{"use strict";e.exports=require("node:zlib")},84914:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>o,routeModule:()=>m,tree:()=>d}),t(19414),t(36852),t(35866);var r=t(23191),a=t(88716),i=t(37922),l=t.n(i),n=t(95231),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);t.d(s,c);let d=["",{children:["maintenance",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,19414)),"/Users/memimal/Desktop/PROJECTS/MMG/mmg-platform/app/maintenance/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,36852)),"/Users/memimal/Desktop/PROJECTS/MMG/mmg-platform/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/memimal/Desktop/PROJECTS/MMG/mmg-platform/app/maintenance/page.tsx"],u="/maintenance/page",x={require:t,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/maintenance/page",pathname:"/maintenance",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},81461:(e,s,t)=>{Promise.resolve().then(t.bind(t,10750))},10750:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>A});var r=t(10326),a=t(88455),i=t(17577),l=t(90434),n=t(19395),c=t(33071),d=t(567),o=t(90772),u=t(54432),x=t(34474),m=t(43273),h=t(65304),p=t(48998),g=t(79635),j=t(67048),y=t(41291),w=t(30361);let N=(0,t(62881).Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var v=t(50949),f=t(83855),b=t(88307),q=t(37358),C=t(29798),Z=t(12714),O=t(15919),_=t(69508),P=t(98091),k=t(60097),I=t(58895),S=t(85546);function Q({onRequestSelect:e,propertyId:s,unitId:t,showFilters:a=!0}){let{user:Q}=(0,n.aC)(),[A,M]=(0,i.useState)([]),[E,T]=(0,i.useState)(!0),[R,z]=(0,i.useState)(""),[D,X]=(0,i.useState)(""),[B,G]=(0,i.useState)("all"),[L,J]=(0,i.useState)("all"),[U,V]=(0,i.useState)("all"),Y=async e=>{if(confirm("Are you sure you want to delete this maintenance request? This action cannot be undone."))try{await (0,S.hm)(e),M(s=>s.filter(s=>s.id!==e))}catch(e){z(e.message)}},$=async(e,s)=>{try{await (0,S.ty)(e,s),M(t=>t.map(t=>t.id===e?{...t,status:s}:t))}catch(e){z(e.message)}},W=A.filter(e=>{if(!D)return!0;let s=D.toLowerCase();return e.title.toLowerCase().includes(s)||e.description.toLowerCase().includes(s)||e.category.toLowerCase().includes(s)}),F=e=>({pending:"bg-yellow-100 text-yellow-800",assigned:"bg-blue-100 text-blue-800",in_progress:"bg-orange-100 text-orange-800",awaiting_approval:"bg-purple-100 text-purple-800",completed:"bg-green-100 text-green-800",cancelled:"bg-gray-100 text-gray-800"})[e],H=e=>({pending:p.Z,assigned:g.Z,in_progress:j.Z,awaiting_approval:y.Z,completed:w.Z,cancelled:N})[e],K=e=>({low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",emergency:"bg-red-100 text-red-800"})[e],ee=e=>"emergency"===e?v.Z:null,es=e=>Q?.role==="admin"||Q?.id===e.submittedBy||Q?.role==="agent"&&e.assignedTo===Q.id,et=e=>Q?.role==="admin"||Q?.id===e.submittedBy&&"pending"===e.status;return E&&0===A.length?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx(h.O,{className:"h-8 w-48"}),r.jsx(h.O,{className:"h-4 w-64 mt-2"})]}),r.jsx(h.O,{className:"h-10 w-32"})]}),a&&r.jsx(c.Zb,{children:r.jsx(c.aY,{className:"pt-6",children:(0,r.jsxs)("div",{className:"flex gap-4",children:[r.jsx(h.O,{className:"h-10 flex-1"}),r.jsx(h.O,{className:"h-10 w-32"}),r.jsx(h.O,{className:"h-10 w-32"})]})})}),r.jsx("div",{className:"grid grid-cols-1 gap-4",children:[1,2,3].map(e=>r.jsx(c.Zb,{children:r.jsx(c.aY,{className:"pt-6",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[r.jsx(h.O,{className:"h-6 w-16"}),r.jsx(h.O,{className:"h-6 w-20"})]}),r.jsx(h.O,{className:"h-5 w-64 mb-2"}),r.jsx(h.O,{className:"h-4 w-full"})]}),r.jsx(h.O,{className:"h-8 w-8"})]})})},e))})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Maintenance Requests"}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Manage maintenance and service requests (",A.length," requests)"]})]}),(Q?.role==="admin"||Q?.role==="agent"||Q?.role==="tenant")&&r.jsx(o.z,{asChild:!0,children:(0,r.jsxs)(l.default,{href:"/maintenance/new",children:[r.jsx(f.Z,{className:"mr-2 h-4 w-4"}),"New Request"]})})]}),R&&(0,r.jsxs)(m.bZ,{variant:"destructive",children:[r.jsx(y.Z,{className:"h-4 w-4"}),r.jsx(m.X,{children:R})]}),a&&r.jsx(c.Zb,{children:r.jsx(c.aY,{className:"pt-6",children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[r.jsx("div",{className:"flex-1",children:(0,r.jsxs)("div",{className:"relative",children:[r.jsx(b.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),r.jsx(u.I,{placeholder:"Search requests by title, description, or category...",className:"pl-8",value:D,onChange:e=>X(e.target.value)})]})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(x.Ph,{value:B,onValueChange:e=>G(e),children:[r.jsx(x.i4,{className:"w-[140px]",children:r.jsx(x.ki,{placeholder:"Status"})}),(0,r.jsxs)(x.Bw,{children:[r.jsx(x.Ql,{value:"all",children:"All Status"}),r.jsx(x.Ql,{value:"pending",children:"Pending"}),r.jsx(x.Ql,{value:"assigned",children:"Assigned"}),r.jsx(x.Ql,{value:"in_progress",children:"In Progress"}),r.jsx(x.Ql,{value:"completed",children:"Completed"}),r.jsx(x.Ql,{value:"cancelled",children:"Cancelled"})]})]}),(0,r.jsxs)(x.Ph,{value:L,onValueChange:e=>J(e),children:[r.jsx(x.i4,{className:"w-[140px]",children:r.jsx(x.ki,{placeholder:"Priority"})}),(0,r.jsxs)(x.Bw,{children:[r.jsx(x.Ql,{value:"all",children:"All Priority"}),r.jsx(x.Ql,{value:"emergency",children:"Emergency"}),r.jsx(x.Ql,{value:"high",children:"High"}),r.jsx(x.Ql,{value:"medium",children:"Medium"}),r.jsx(x.Ql,{value:"low",children:"Low"})]})]}),(0,r.jsxs)(x.Ph,{value:U,onValueChange:e=>V(e),children:[r.jsx(x.i4,{className:"w-[140px]",children:r.jsx(x.ki,{placeholder:"Category"})}),(0,r.jsxs)(x.Bw,{children:[r.jsx(x.Ql,{value:"all",children:"All Categories"}),r.jsx(x.Ql,{value:"plumbing",children:"Plumbing"}),r.jsx(x.Ql,{value:"electrical",children:"Electrical"}),r.jsx(x.Ql,{value:"structural",children:"Structural"}),r.jsx(x.Ql,{value:"appliance",children:"Appliance"}),r.jsx(x.Ql,{value:"cleaning",children:"Cleaning"}),r.jsx(x.Ql,{value:"other",children:"Other"})]})]})]})]})})}),0!==W.length||E?r.jsx("div",{className:"space-y-4",children:W.map(s=>{let t=H(s.status),a=ee(s.priority);return r.jsx(c.Zb,{className:"hover:shadow-lg transition-shadow",children:r.jsx(c.aY,{className:"pt-6",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,r.jsxs)(d.C,{className:F(s.status),children:[r.jsx(t,{className:"w-3 h-3 mr-1"}),s.status.replace("_"," ")]}),(0,r.jsxs)(d.C,{className:K(s.priority),children:[a&&r.jsx(a,{className:"w-3 h-3 mr-1"}),s.priority]}),r.jsx(d.C,{variant:"outline",children:s.category})]}),r.jsx("h3",{className:"text-lg font-semibold mb-2 line-clamp-1",children:s.title}),r.jsx("p",{className:"text-muted-foreground text-sm mb-3 line-clamp-2",children:s.description}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-4 text-sm text-muted-foreground",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(q.Z,{className:"w-4 h-4 mr-1"}),r.jsx("span",{children:(0,I.Q)(s.createdAt.toDate(),{addSuffix:!0})})]}),s.unitId&&(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(C.Z,{className:"w-4 h-4 mr-1"}),(0,r.jsxs)("span",{children:["Unit ",s.unitId.slice(0,8),"..."]})]}),s.assignedTo&&(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(g.Z,{className:"w-4 h-4 mr-1"}),r.jsx("span",{children:"Assigned"})]}),s.estimatedCost&&s.estimatedCost>0&&r.jsx("div",{className:"flex items-center",children:(0,r.jsxs)("span",{className:"font-medium",children:["$",s.estimatedCost.toLocaleString()]})})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,r.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>e?.(s.id),children:[r.jsx(Z.Z,{className:"w-4 h-4 mr-1"}),"View"]}),(0,r.jsxs)(k.h_,{children:[r.jsx(k.$F,{asChild:!0,children:r.jsx(o.z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:r.jsx(O.Z,{className:"h-4 w-4"})})}),(0,r.jsxs)(k.AW,{align:"end",children:[r.jsx(k.Xi,{asChild:!0,children:(0,r.jsxs)(l.default,{href:`/maintenance/${s.id}`,children:[r.jsx(Z.Z,{className:"mr-2 h-4 w-4"}),"View Details"]})}),es(s)&&r.jsx(k.Xi,{asChild:!0,children:(0,r.jsxs)(l.default,{href:`/maintenance/${s.id}/edit`,children:[r.jsx(_.Z,{className:"mr-2 h-4 w-4"}),"Edit"]})}),(Q?.role==="admin"||Q?.role==="agent")&&"pending"===s.status&&(0,r.jsxs)(k.Xi,{onClick:()=>$(s.id,"assigned"),children:[r.jsx(g.Z,{className:"mr-2 h-4 w-4"}),"Assign to Me"]}),s.assignedTo===Q?.id&&"assigned"===s.status&&(0,r.jsxs)(k.Xi,{onClick:()=>$(s.id,"in_progress"),children:[r.jsx(j.Z,{className:"mr-2 h-4 w-4"}),"Start Work"]}),s.assignedTo===Q?.id&&"in_progress"===s.status&&(0,r.jsxs)(k.Xi,{onClick:()=>$(s.id,"completed"),children:[r.jsx(w.Z,{className:"mr-2 h-4 w-4"}),"Mark Complete"]}),et(s)&&(0,r.jsxs)(k.Xi,{onClick:()=>Y(s.id),className:"text-red-600",children:[r.jsx(P.Z,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})})},s.id)})}):r.jsx(c.Zb,{children:(0,r.jsxs)(c.aY,{className:"pt-6 text-center",children:[r.jsx(j.Z,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No maintenance requests found"}),r.jsx("p",{className:"text-gray-600 mb-4",children:D?"No requests match your search criteria.":"Get started by submitting a maintenance request."}),!D&&(Q?.role==="admin"||Q?.role==="agent"||Q?.role==="tenant")&&r.jsx(o.z,{asChild:!0,children:(0,r.jsxs)(l.default,{href:"/maintenance/new",children:[r.jsx(f.Z,{className:"mr-2 h-4 w-4"}),"New Request"]})})]})}),E&&A.length>0&&r.jsx("div",{className:"text-center py-4",children:(0,r.jsxs)("div",{className:"inline-flex items-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Loading more requests..."]})})]})}function A(){return r.jsx(a.Z,{allowedRoles:["admin","agent","owner","tenant"],children:r.jsx(Q,{})})}},85546:(e,s,t)=>{"use strict";t.d(s,{eD:()=>c,getAssignedRequests:()=>x,getOverdueRequests:()=>m,getPendingRequests:()=>u,hm:()=>n,ty:()=>d});var r=t(76),a=t(20902);let i=(0,r.hJ)(a.db,"maintenanceRequests"),l=async(e,s)=>{try{let t=(0,r.JU)(a.db,"maintenanceRequests",e);await (0,r.r7)(t,s)}catch(e){throw console.error("Error updating maintenance request:",e),e}},n=async e=>{try{let s=(0,r.JU)(a.db,"maintenanceRequests",e);await (0,r.oe)(s)}catch(e){throw console.error("Error deleting maintenance request:",e),e}},c=async(e={})=>{try{let s=(0,r.IO)(i);e.status&&(s=(0,r.IO)(s,(0,r.ar)("status","==",e.status))),e.priority&&(s=(0,r.IO)(s,(0,r.ar)("priority","==",e.priority))),e.category&&(s=(0,r.IO)(s,(0,r.ar)("category","==",e.category))),e.type&&(s=(0,r.IO)(s,(0,r.ar)("type","==",e.type))),e.propertyId&&(s=(0,r.IO)(s,(0,r.ar)("propertyId","==",e.propertyId))),e.unitId&&(s=(0,r.IO)(s,(0,r.ar)("unitId","==",e.unitId))),e.submittedBy&&(s=(0,r.IO)(s,(0,r.ar)("submittedBy","==",e.submittedBy))),e.assignedTo&&(s=(0,r.IO)(s,(0,r.ar)("assignedTo","==",e.assignedTo))),s=(0,r.IO)(s,(0,r.Xo)("createdAt","desc")),e.pageSize&&(s=(0,r.IO)(s,(0,r.b9)(e.pageSize))),e.lastDoc&&(s=(0,r.IO)(s,(0,r.TQ)(e.lastDoc)));let t=await (0,r.PL)(s),a=[];return t.forEach(e=>{a.push({id:e.id,...e.data()})}),{requests:a,lastDoc:t.docs[t.docs.length-1],hasMore:t.docs.length===(e.pageSize||0)}}catch(e){throw console.error("Error getting maintenance requests:",e),e}},d=async(e,s,t)=>{try{let a={status:s,...t};"completed"===s&&(a.completedAt=(0,r.Bt)()),await l(e,a)}catch(e){throw console.error("Error updating maintenance request status:",e),e}},o=async e=>(await c({status:e})).requests,u=async()=>o("pending"),x=async e=>(await c({assignedTo:e})).requests,m=async()=>{try{let e=await o("assigned"),s=await o("in_progress"),t=[...e,...s],r=new Date;return t.filter(e=>{if(!e.assignedAt)return!1;let s=e.assignedAt.toDate(),t=(r.getTime()-s.getTime())/36e5,a="emergency"===e.priority?4:"high"===e.priority?48:72;return t>a})}catch(e){throw console.error("Error getting overdue requests:",e),e}}},67048:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=(0,t(62881).Z)("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]])},19414:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(68570).createProxy)(String.raw`/Users/memimal/Desktop/PROJECTS/MMG/mmg-platform/app/maintenance/page.tsx#default`)}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[100,825,423,344,506,404,799,428,307,967,89],()=>t(84914));module.exports=r})();